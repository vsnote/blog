<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>Vim 过滤匹配的文本 - 陈三</title>
<meta property="og:title" content="Vim 过滤匹配的文本 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">1 min read</span>
    

    <h1 class="article-title">Vim 过滤匹配的文本</h1>

    
    <span class="article-date">February 2, 2014</span>
    

    <div class="article-content">
      <p>我偶尔会有这样一种需求：从文本中过滤出需要的内容 &#8211; 这个内容可以用正则表达式匹配到。比如这一个 <a href="https://gist.github.com/chenxsan/9166312" title="Gist">HTTP 请求/响应信息</a>文件，取一小段如下：</p>

<pre><code>POST http://d.web2.qq.com/channel/send_sess_msg2 HTTP/1.1
Origin: http://web2.qq.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20100101 Firefox/23.0
Content-Type: application/x-www-form-urlencoded
Accept: */*
Referer: http://web2.qq.com
Content-Length: 716
Cookie: pgv_pvid=5576286324; pgv_info=pgvReferrer=&amp;ssid=s3145890760; verifysession=h02MUeRLXDVh33iXxfbIXP7QPznYyuVOP4qCJPVhXD-BDw72d9W6sLl7dfrUx2Wfsq4w1Vhw2ggRjxhhzMf2vfANA**; ptui_loginuin=2804187804; ptisp=ctc; RK=dBvTz+lA+k; ptcz=45fbc214cbc91062f919bf6c753c60da6fa4ea937a08bfd0a94b33a29f3eab94; ptwebqq=2f4cdbb354c4cfe971e15aa3872ffbffe86bff65c8b0cc4a2998e4e0e9f89c23; pt2gguin=o2804187804; uin=o2804187804; skey=@0uc0QCvS5; p_uin=o2804187804; p_skey=*HFTMH8l0rM5Gszdip1vHyJI4MneS73LL*xTsgtViNM_; pt4_token=BGcr-KPcEj-TDwNlt6HJhQ__
Connection: Keep-Alive
Accept-Encoding: gzip
Accept-Language: zh-CN,en,*
Host: d.web2.qq.com

r={&quot;to&quot;:&lt;mark&gt;3105771284&lt;/mark&gt;,&quot;content&quot;:&quot;[[\&quot;font\&quot;,{\&quot;name\&quot;:\&quot;宋体\&quot;,\&quot;size\&quot;:20,\&quot;style\&quot;:[0,0,0],\&quot;color\&quot;:\&quot;ff0000\&quot;}]]&quot;,&quot;clientid&quot;:&quot;36385748&quot;,&quot;psessionid&quot;:&quot;8368046764001d636f6e6e7365727665725f77656271714031302e3133392e372e31363000007ba400000228036e04009c8224a76d0000000a403075633051437653356d00000028d2cbdb5f463a51f3eb82c04c37cce7848ebb9d449aca351811c72a04a5f75412ab0590b690630bdb&quot;,&quot;service_type&quot;:0,&quot;group_sig&quot;:&quot;da531819808f120bd0b6c9fc377e6fc76af363ef80d7ba965e7aa1de952fbaf9710ff04e74743c2dd104aba1f357758b&quot;}
HTTP/1.1 200 OK
Date: Fri, 03 Jan 2014 06:51:14 GMT
Content-Type: text/plain; charset=utf-8
Content-Length: 29
Cache-Control: no-cache
Connection: close

{&quot;retcode&quot;:0,&quot;result&quot;:&quot;ok&quot;}
</code></pre>

<p>我需要 <code>r={&quot;to&quot;:</code> 后的一组数字 &#8211; 号码。</p>

<p>我马上可以想到的处理方式是：</p>

<ol>
<li>匹配该组数字外的所有文本并删除</li>
<li>匹配该组数字，删除不匹配的所有文本</li>
</ol>

<p>但就我查找的资料， Vim 并没有便利的方法实现上面的处理 &#8211; 你也可以认为上面的处理方式本身就有些问题。所以还是要绕点远路。</p>

<p>有一个需要声明的概念是，Vim 在查找/替换时，是针对<strong>行</strong>做处理的，这个与 grep 或 sed 是一样的。</p>

<ol>
<li><p>删除所有不匹配规则 <code>r={&quot;to&quot;:</code> 的行<sup class="footnote-ref" id="fnref:11613-1"><a rel="footnote" href="#fn:11613-1">1</a></sup></p>

<pre><code>:v/r={&quot;to&quot;:\d\+,/d
</code></pre>

<p>或者：</p>

<pre><code>:g!/r={&quot;to&quot;:\d\+,/d
</code></pre>

<p>命令中最后一个 <code>d</code> 表示<strong>删除不匹配的行</strong>。</p>

<p>处理后，文件剩下如下格式的内容：</p>

<pre><code>r={&quot;to&quot;:3105771284,&quot;content&quot;:&quot;[[\&quot;font\&quot;,{\&quot;name\&quot;:\&quot;宋体\&quot;,\&quot;size\&quot;:20,\&quot;style\&quot;:[0,0,0],\&quot;color\&quot;:\&quot;ff0000\&quot;}]]&quot;,&quot;clientid&quot;:&quot;36385748&quot;,&quot;psessionid&quot;:&quot;8368046764001d636f6e6e7365727665725f77656271714031302e3133392e372e31363000007ba400000228036e04009c8224a76d0000000a403075633051437653356d00000028d2cbdb5f463a51f3eb82c04c37cce7848ebb9d449aca351811c72a04a5f75412ab0590b690630bdb&quot;,&quot;service_type&quot;:0,&quot;group_sig&quot;:&quot;da531819808f120bd0b6c9fc377e6fc76af363ef80d7ba965e7aa1de952fbaf9710ff04e74743c2dd104aba1f357758b&quot;}
r={&quot;to&quot;:3688265155,&quot;content&quot;:&quot;[[\&quot;font\&quot;,{\&quot;name\&quot;:\&quot;宋体\&quot;,\&quot;size\&quot;:20,\&quot;style\&quot;:[0,0,0],\&quot;color\&quot;:\&quot;ff0000\&quot;}]]&quot;,&quot;clientid&quot;:&quot;36385748&quot;,&quot;psessionid&quot;:&quot;8368046764001d636f6e6e7365727665725f77656271714031302e3133392e372e31363000007ba400000228036e04009c8224a76d0000000a403075633051437653356d00000028d2cbdb5f463a51f3eb82c04c37cce7848ebb9d449aca351811c72a04a5f75412ab0590b690630bdb&quot;,&quot;service_type&quot;:0,&quot;group_sig&quot;:&quot;61e61272ea83bba9efbe74ce82081c2cd9d4b4c88773f4e72e7fa535cdf9c2dc0801edb02719e6c7abd5e24ce8dec4aa&quot;}
r={&quot;to&quot;:1559096246,&quot;content&quot;:&quot;[[\&quot;font\&quot;,{\&quot;name\&quot;:\&quot;宋体\&quot;,\&quot;size\&quot;:20,\&quot;style\&quot;:[0,0,0],\&quot;color\&quot;:\&quot;ff0000\&quot;}]]&quot;,&quot;clientid&quot;:&quot;36385748&quot;,&quot;psessionid&quot;:&quot;8368046764001d636f6e6e7365727665725f77656271714031302e3133392e372e31363000007ba400000228036e04009c8224a76d0000000a403075633051437653356d00000028d2cbdb5f463a51f3eb82c04c37cce7848ebb9d449aca351811c72a04a5f75412ab0590b690630bdb&quot;,&quot;service_type&quot;:0,&quot;group_sig&quot;:&quot;24437e4e1f42517f3c6900eb26407dcbd607ca3a474957e0d056b77a98820b5038dd4fbdc56b9a178e128861b9097481&quot;}
</code></pre></li>

<li><p>Vim 替换命令<sup class="footnote-ref" id="fnref:11613-2"><a rel="footnote" href="#fn:11613-2">2</a></sup></p>

<pre><code>:%s/^r={&quot;to&quot;:\(\d\+\),.*$/\1
</code></pre>

<p><code>%</code> &#8211; 查找文件中所有行</p>

<p><code>s</code> &#8211; Vim 的替换命令 substitute 命令的短写法</p>

<p><code>^r={&quot;to&quot;:\(\d\+\),.$*</code> &#8211; 正则规则，指示要匹配的内容</p>

<p><code>\1</code> &#8211; 前面正则规则中 () 匹配到的内容</p></li>
</ol>

<p>Vim 的正则看起来略绕，比如 + 要转义，( 也要转义。我在写 JavaScript 正则时是不需要的。</p>

<p>如此，我们就过滤出文件里所有的号码了。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:11613-1"><a href="http://vim.wikia.com/wiki/Power_of_g">Power of g &#8211; Vim Tips Wiki</a>
 <a class="footnote-return" href="#fnref:11613-1"><sup>[return]</sup></a></li>
<li id="fn:11613-2"><a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html">Vim documentation: pattern</a>
 <a class="footnote-return" href="#fnref:11613-2"><sup>[return]</sup></a></li>
</ol>
</div>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

