<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>Github 最佳实践 - 陈三</title>
<meta property="og:title" content="Github 最佳实践 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">Github 最佳实践</h1>

    
    <span class="article-date">September 9, 2014</span>
    

    <div class="article-content">
      <p>标题写的是「最佳实践」，但其实是作者自己的标准，并非绝对意义。</p>

<p>另外，这个「最佳实践」限定在 Github 上贡献代码。</p>

<p>我用 Git 的时间，估计有一两年，但因为都是自嗨，许多命令根本用不到。直到后来在 Github 上提交过几回 pull request，犯过错，就开始手忙脚乱，查各种资料，实验，实践，总结，才渐渐知道，大概是怎样一个思路。</p>

<p><strong>长话短说版本</strong>（以下内容假定你熟悉 Git 的各种基本命令）：</p>

<ol>
<li>fork 开源库 <a href="https://github.com/google/WebFundamentals.git">A</a> 到自己的 github，假设为库 <a href="https://github.com/chenxsan/WebFundamentals">B</a></li>

<li><p>从库 B clone 一份到本地，假设目录为 fundamentals</p>

<pre><code>$ git clone git@github.com:chenxsan/WebFundamentals.git fundamentals
</code></pre></li>

<li><p>给本地库配置上游</p>

<pre><code>$ git remote add upstream https://github.com/google/WebFundamentals.git
</code></pre></li>

<li><p>从本地 master 分支分出一个 dev 分支</p>

<pre><code>$ git checkout -b dev
</code></pre></li>

<li><p>在 dev 分支上出力</p>

<pre><code>$ git add -u
$ git commit -m '我做出贡献了'
</code></pre></li>

<li><p>将 dev 分支 <code>push</code> 到 github</p>

<pre><code>$ git push origin dev:dev
</code></pre>

<p><strong>注意：</strong> <code>:</code> 前是本地的分支名，<code>:</code> 后是远程的分支名。远程的分支名任你取。</p></li>

<li><p>从 github 上的 dev 分支提交 pull request 给上游库 A</p></li>

<li><p>不幸被拒绝，上游库所有者要求你再补点东西；然后上游库有新的 commit</p></li>

<li><p>本地 master 分支更新上游库 A 的代码</p>

<pre><code>$ git stash
$ git checkout master
$ git pull --rebase upstream master
</code></pre></li>

<li><p>本地 dev 分支重新基于 master 来过</p>

<pre><code>$ git checkout dev
$ git rebase master
$ git stash pop
</code></pre>

<p><strong>（如果你的 dev 分支是公开且有人使用，请谨慎使用 <code>rebase</code>，因为它会改成公开的历史）</strong></p></li>

<li><p>继续修改 dev 分支，改完后重复上面的 commit 动作，然后 push 到 github 上再提交 pull request</p>

<pre><code>$ git push --force origin dev
</code></pre>

<p>之所以要加 <code>--force</code>，是因为 github 上的 dev 分支已经跟本地的 dev 有过分歧。git 会提示你先 pull 然后 merge，但那样会一片混乱，所以粗暴点用上 <code>--force</code>。当然，更好的建议是，没事别乱推送到 Github，等确定要提 pull request 时再推送。</p></li>

<li><p>在 pull request 被合并后，删除本地、远程的 dev 分支</p>

<pre><code>$ git push origin --delete dev # 删除远程 dev 分支
$ git branch -D dev # 删除本地 dev 分支
</code></pre>

<p>因为 dev 分支只是出于一时目的使用，所以在 pull request 被合并后，就可以通过命令删除它。也可以在被合并的 pull request 页面上删除，Github 提供有删除按钮。</p></li>

<li><p>将本地 master 分支与上游库同步</p>

<pre><code>$ git pull --rebase upstream master
$ git push
</code></pre></li>
</ol>

<p>这里有几个重点。</p>

<p><strong>一个</strong>是保持 master 分支干净，不在 master 分支上 commit。这一条建议来自 jQuery<sup class="footnote-ref" id="fnref:13490-1"><a rel="footnote" href="#fn:13490-1">1</a></sup>。目的是给自己方便：</p>

<blockquote>
<p>This is really only for your own convenience: it&#8217;s easy for the maintainer of a project to accept your pull request from your master branch, but it&#8217;s problematic for your fork when you want to pull the changes back and your master branch has diverged from upstream.</p>

<p>这纯是为了你自己方便：对项目维护者来说，接受来自你 master 分支的 pull request 是很简单的事，但对你的分支来说，这会是个问题，比如你要从上游分支拉回修改，但是你的 master 分支却已经分道扬镳。</p>
</blockquote>

<p>整个过程中，我们 fork 的 master 分支只是为同步上游库的内容而存在。</p>

<p><strong>另一个</strong>是保持 commit 历史干净<sup class="footnote-ref" id="fnref:13490-2"><a rel="footnote" href="#fn:13490-2">2</a></sup>。所以上面的流程中，拉回上游库的修改用了 <code>--rebase</code>，而不是先 fetch 再 merge。更多请看文末的链接2。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:13490-1"><a href="http://contribute.jquery.org/commits-and-pull-requests/#never-commit-on-master">Commits and Pull Requests | Contribute to jQuery</a>
 <a class="footnote-return" href="#fnref:13490-1"><sup>[return]</sup></a></li>
<li id="fn:13490-2"><a href="http://ginsys.eu/git-and-github-keeping-a-feature-branch-updated-with-upstream/">Git and Github: keeping a feature branch updated with upstream?</a>
 <a class="footnote-return" href="#fnref:13490-2"><sup>[return]</sup></a></li>
</ol>
</div>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

