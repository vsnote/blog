<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>redux.js 的盛行 - 陈三</title>
<meta property="og:title" content="redux.js 的盛行 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">1 min read</span>
    

    <h1 class="article-title">redux.js 的盛行</h1>

    
    <span class="article-date">June 6, 2016</span>
    

    <div class="article-content">
      <p>在 react.js 里，如果把一个组件写在另一个组件的 <code>render</code> 方法里，则其它组件要用它的话，我们又要重复一遍代码。所以我们要抽取它，独立成一个组件。可是，这时它的 <code>state</code> 应该放在哪里？</p>

<p>如果我们把 <code>state</code> 放在组件内部，则父组件有读取子组件数据的需求时，父组件内部就要创建一个变量，还要提供给子组件一个回调，这样，同样的 <code>state</code> 我们会在父、子两个地方实现，则不如 <code>state</code> 只定义在父组件中，通过 <code>props</code> 传递给子组件，这样，子组件的功能就比较单一，便于复用。</p>

<p>但是，又有一个新的问题产生。举一个 Email 组件来说，它可能在登录表单组件里使用，也可能在注册表单组件里使用，这两个父组件的逻辑是不一样的，无法复用，而它们在使用 Email 组件时，却都需要提供给 Email 组件一个变量及一个回调函数 &#8211; 它们在两个父组件中显然又是重复的。</p>

<p>比如我的一个使用 <a href="https://github.com/mobxjs/mobx">mobx</a> 的注册组件：</p>

<pre><code>import React, { Component } from 'react'
import { observable, action, computed } from 'mobx'
import Email from '../common/Email'

@observer
class Register extends Component {
  @observable email = ''
  @computed get emailError () {
    if (this.email.trim() === '') {
      return '请填写邮箱地址'
    }
    if (!emailRegExp.test(this.email.trim())) {
      return '请填写正确的邮箱地址'
    }
    return ''
  }
  render () {
    return (
      &lt;div&gt;
          &lt;Email email={this.email}
            changeEmail={this.changeEmail}
            emailError={this.emailError}
            /&gt;
      &lt;/div&gt;
  }
}
</code></pre>

<p>在登录组件中，几乎一模一样的代码，我又要重复一遍。</p>

<p>Don&#8217;t repeat yourself 说起来当然是简单，但做起来并不容易。就说我们上面所做的演进，目的是满足需求的同时消除重复，但结果我们只是把 repeat 从一个地方迁移到了另一个地方。</p>

<p><a href="http://redux.js.org/index.html">Redux</a> 能解决我们的问题：</p>

<ol>
<li>将父组件中重复的变量存储到 store 中</li>
<li>回调函数拆为 reducer + action</li>
</ol>

<p>这样，我们就不必在多个父组件里重复变量及回调函数。但是，因为我们把变量存储在 store 里，把回调函数拆为 reducer + action，则我们在使用时，就又多了一个读取过程，在 redux.js 里，这通过 <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#api">react-redux</a> 实现。</p>

<p>当然，像 redux 这样提取父组件中重复变量然后复用的做法并不能满足所有需求。很多时候，我们确实需要两份数据，这时，redux <a href="https://github.com/reactjs/redux/issues/822#issuecomment-186614362">也没有</a>好的<a href="https://github.com/reactjs/redux/issues/897#issuecomment-148233789">解决办法</a>，因为 action 没法复用，reducer 也没法复用。</p>

<p>在 redux 的定义里，组件有两种：</p>

<ol>
<li>Container component</li>
<li>Presentational component</li>
</ol>

<p>上面的例子里，Email 组件是 Presentational component，要做到它的复用十分容易，而登录或注册组件则属于 Container component，它们的复用性就非常低，代码上的重复也很难避免 &#8211; 目前我还没看到较好的解决办法。</p>

<p>如果你有，欢迎留言：）</p>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

