<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>Handlebars.js 预编译 - 陈三</title>
<meta property="og:title" content="Handlebars.js 预编译 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">Handlebars.js 预编译</h1>

    
    <span class="article-date">January 1, 2014</span>
    

    <div class="article-content">
      

<p>Handlebars.js 官网上对预编译<sup class="footnote-ref" id="fnref:11247-1"><a rel="footnote" href="#fn:11247-1">1</a></sup>是这样说的：</p>

<ol>
<li>你需要安装 Node.js</li>
<li>你需要在全局环境中，通过 Npm 安装 handlebars 包</li>
</ol>

<p>然后你就可以通过命令预编译你的 handlebars 模板文件：</p>

<pre><code>$ handlebars &lt;input&gt; --output &lt;output&gt;
</code></pre>

<p>假设我有一个模板文件，名称为 person.handlebars，内容很简单，如下：</p>

<pre><code>&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;This is {{firstname}} {{lastname}}&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
</code></pre>

<p>假定编译后输出文件的名称为 person.js<sup class="footnote-ref" id="fnref:11247-2"><a rel="footnote" href="#fn:11247-2">2</a></sup>，检查 person.js 文件内容，可以看到，一个 Handlebars.templates 对象下增加了一个 <code>person</code> 属性名：</p>

<pre><code>var template = Handlebars.template, templates = Handlebars.templates = Handlebars.templates || {};
templates['person'] = template(function (Handlebars,depth0,helpers,partials,data) {
    ......
</code></pre>

<p>之后，我们只要在页面 HTML 页面引用 handlebars.runtime.js、person.js 文件，并且通过 js 传入数据：</p>

<pre><code>&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Handlebar.js 模板&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;person&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;js/handlebars.runtime.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;js/person.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        var compiledTemplate = Handlebars.templates['person'],
        html = compiledTemplate({&quot;firstname&quot;: &quot;三&quot;, &quot;lastname&quot;: &quot;陈&quot;});
        document.getElementById('person').innerHTML = html;
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>在浏览器打开 HTML 页面，可以看到最终结果：This is 三 陈。</p>

<p>OK，看完 Handlebars.js 官网提供的纯手工预编译模板的方法后，再来看看 Grunt.js 是怎样全自动预编译模板的。</p>

<h2 id="grunt-contrib-handlebars-11247-3">grunt-contrib-handlebars<sup class="footnote-ref" id="fnref:11247-3"><a rel="footnote" href="#fn:11247-3">3</a></sup></h2>

<p>因为是基于 Grunt.js，所以假定环境中已经安装好 Node.js、Npm，<code>grunt</code> 命令也能正常运行。</p>

<p>首先，需要在工作目录下需要安装 <code>grunt-contrib-handlebars</code> 模块：</p>

<pre><code>$ cd myJob
$ npm install grunt-contrib-handlebars --save-dev
</code></pre>

<p>安装完 grunt-contrib-handlebars 模块后，我们需要在 Gruntfile.js 文件中加载它：</p>

<pre><code>grunt.loadNpmTasks('grunt-contrib-handlebars');
</code></pre>

<p>然后，还是在 Gruntfile.js 文件中，配置预编译任务：</p>

<pre><code>handlebars: { //定义预编译任务
    compile: {
        options: {
            namespace: &quot;JST&quot; //命名空间，这个很重要，后面会提到
        },
        files: [{
            expand: true,
            cwd: 'js/src/handlebars',
            src: '**/*.handlebars', //模板文件
            dest: 'js/dest/handlebars/', //编译后的文件存放位置
            ext: '.js' //编译后的文件格式          
        }]
        //如果要把所有模板文件编译到一个 .js 文件，则可以写成：
        //files: {&quot;js/dest/template.js&quot;: ['js/src/handlebars/**/*.handlebars']}
    }
}
watch: { //监控文件变化并自动执行预编译任务
    precompile: {
        files: 'js/src/handlebars/**/*.handlebars',
        tasks: ['handlebars']
    }
}
</code></pre>

<p>这里，如果等不及 <code>grunt watch</code>，可以先执行 <code>grunt handlebars</code> 命令预编译，得到的 person.js <sup class="footnote-ref" id="fnref:11247-4"><a rel="footnote" href="#fn:11247-4">4</a></sup>文件如下：</p>

<pre><code>this[&quot;JST&quot;] = this[&quot;JST&quot;] || {};

this[&quot;JST&quot;][&quot;js/person.handlebars&quot;] = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
this.compilerInfo = [4,'&gt;= 1.0.0'];
......
</code></pre>

<p>这个版本跟手工生成的可不太一样。当然，如果想生成与手工一样的结果也很简单，只要把选项中的 <code>namespace</code> 设置为 <code>false</code>。</p>

<p>好了，现在我们的 <code>person</code> 存放的位置变了，不再是之前的 <code>templates['person']</code>，而是 <code>this[&quot;JST&quot;][&quot;js/person.handlebars&quot;]</code><sup class="footnote-ref" id="fnref:11247-5"><a rel="footnote" href="#fn:11247-5">5</a></sup>，那么，在 HTML 里，我们的 <code>compiledTemplate</code> 是怎么获取？很简单：</p>

<pre><code>var compiledTemplate = JST[&quot;js/person.handlebars&quot;],
</code></pre>

<p>这是因为，在 grunt-contrib-handlebars 自动预编译的文件中，<code>this</code> 在浏览器环境下指向 window 对象，所以我们不过是把模板对象存放到一个新的命名空间 JST 下的 &#8220;js/person.handlebars&#8221; 属性名里，结果是，代码冲突的可能性更小了。</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:11247-1"><a href="http://handlebarsjs.com/precompilation.html">Handlebars.js: Minimal Templating on Steroids</a>
 <a class="footnote-return" href="#fnref:11247-1"><sup>[return]</sup></a></li>
<li id="fn:11247-2"><a href="https://gist.github.com/chenxsan/8351314#file-person-js">Handlebars.js 预编译的结果</a>
 <a class="footnote-return" href="#fnref:11247-2"><sup>[return]</sup></a></li>
<li id="fn:11247-3"><a href="https://github.com/gruntjs/grunt-contrib-handlebars">gruntjs/grunt-contrib-handlebars</a>
 <a class="footnote-return" href="#fnref:11247-3"><sup>[return]</sup></a></li>
<li id="fn:11247-4"><a href="https://gist.github.com/chenxsan/8352178">Grunt 自动编译的 Handlebars.js 模板</a>
 <a class="footnote-return" href="#fnref:11247-4"><sup>[return]</sup></a></li>
<li id="fn:11247-5"><a href="http://danburzo.ro/grunt/chapters/handlebars/">Pre-compile your Handlebars templates</a>
 <a class="footnote-return" href="#fnref:11247-5"><sup>[return]</sup></a></li>
</ol>
</div>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

