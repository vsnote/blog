<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>Chrome 开发者工具之内存使用分析 - 陈三</title>
<meta property="og:title" content="Chrome 开发者工具之内存使用分析 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">1 min read</span>
    

    <h1 class="article-title">Chrome 开发者工具之内存使用分析</h1>

    
    <span class="article-date">December 12, 2015</span>
    

    <div class="article-content">
      

<p>对我们 JavaScript 开发者来说，因为内存有自动回收机制，所以大部分时间，我们并没打算关心内存。</p>

<p>但是，移动设备的内存通常有限，卡顿、崩溃的现象并不少见，于是我们又不得不开始关心内存。</p>

<p>从哪里开始？怎样的一个步骤？</p>

<p>（因为 chrome 开发者工具经常变动，所以这里说明一下，以下截图如果不是特别强调，用到的浏览器均指 Chrome 49.0.2582.0 (Official Build) canary (64-bit) 版本）</p>

<ol>
<li><p>Chrome 内置的 task manager，（图片来自 <a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/memory-diagnosis?hl=en#monitor-memory-using-chrome-task-manager">Google Devtools 网站</a>），粗略观察</p>

<p><img src="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/imgs/task-manager.png" alt="chrome 任务管理器" /></p></li>

<li><p>在 Chrome 内置任务管理器中发现内存可能有问题后，我们想知道，具体是怎样：</p>

<ol>
<li>打开 Chrome Devtools</li>
<li>点击 Timeline 标签页</li>
<li>勾选 <strong>Memory</strong> 选项</li>
<li>点击录制按钮
<br /></li>
</ol>

<p><a href="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png" rel="attachment wp-att-17720"><img src="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png" alt="chrome devtools timeline panel with memory option on" width="792" class="alignnone size-full wp-image-17720" srcset="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png 792w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-300x197.png 300w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-100x66.png 100w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-768x505.png 768w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-520x342.png 520w" sizes="(max-width: 792px) 100vw, 792px" /></a></p>

<p>如图，我们能看到，滚动页面时，内存用量在逐步升高。</p></li>

<li><p>是谁引起的内存增加？增加的内存是否可以回收，如果不能，是否导致内存泄漏？Chrome 开发者工具 Profiles 面板下有两个内存分析的工具，</p>

<ul>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/heap-snapshots?hl=en">Take Heap Snapshot</a></li>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/allocation-profiler?hl=en">Record Heap Allocations</a>
<br /></li>
</ul>

<p>前者能够捕捉当前的内存分配情况，后者可纪录不同时间里内存分配与回收的情况。它们的用法，Chrome devtools 网站上均有说明，虽然文档配图部分老旧，但内容多数并没有问题。另外，这两个工具涉及到大量的内存知识，所以算是 devtools 里比较复杂的应用。</p>

<p>我个人的经验，Take Heap Snapshot 用得更多，我们可以多次录制快照，然后比对快照，哪些操作引发了哪些类型的数据增加或减小，非常容易定位。</p></li>
</ol>

<h2 id="扩展阅读">扩展阅读</h2>

<ol>
<li>视频 &#8211; [对我们 JavaScript 开发者来说，因为内存有自动回收机制，所以大部分时间，我们并没打算关心内存。</li>
</ol>

<p>但是，移动设备的内存通常有限，卡顿、崩溃的现象并不少见，于是我们又不得不开始关心内存。</p>

<p>从哪里开始？怎样的一个步骤？</p>

<p>（因为 chrome 开发者工具经常变动，所以这里说明一下，以下截图如果不是特别强调，用到的浏览器均指 Chrome 49.0.2582.0 (Official Build) canary (64-bit) 版本）</p>

<ol>
<li><p>Chrome 内置的 task manager，（图片来自 <a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/memory-diagnosis?hl=en#monitor-memory-using-chrome-task-manager">Google Devtools 网站</a>），粗略观察</p>

<p><img src="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/imgs/task-manager.png" alt="chrome 任务管理器" /></p></li>

<li><p>在 Chrome 内置任务管理器中发现内存可能有问题后，我们想知道，具体是怎样：</p>

<ol>
<li>打开 Chrome Devtools</li>
<li>点击 Timeline 标签页</li>
<li>勾选 <strong>Memory</strong> 选项</li>
<li>点击录制按钮
<br /></li>
</ol>

<p><a href="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png" rel="attachment wp-att-17720"><img src="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png" alt="chrome devtools timeline panel with memory option on" width="792" class="alignnone size-full wp-image-17720" srcset="https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory.png 792w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-300x197.png 300w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-100x66.png 100w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-768x505.png 768w, https://www.zfanw.com/blog/wp-content/uploads/2015/12/chrome-devtools-timeline-memory-520x342.png 520w" sizes="(max-width: 792px) 100vw, 792px" /></a></p>

<p>如图，我们能看到，滚动页面时，内存用量在逐步升高。</p></li>

<li><p>是谁引起的内存增加？增加的内存是否可以回收，如果不能，是否导致内存泄漏？Chrome 开发者工具 Profiles 面板下有两个内存分析的工具，</p>

<ul>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/heap-snapshots?hl=en">Take Heap Snapshot</a></li>
<li><a href="https://developers.google.com/web/tools/chrome-devtools/profile/memory-problems/allocation-profiler?hl=en">Record Heap Allocations</a>
<br /></li>
</ul>

<p>前者能够捕捉当前的内存分配情况，后者可纪录不同时间里内存分配与回收的情况。它们的用法，Chrome devtools 网站上均有说明，虽然文档配图部分老旧，但内容多数并没有问题。另外，这两个工具涉及到大量的内存知识，所以算是 devtools 里比较复杂的应用。</p>

<p>我个人的经验，Take Heap Snapshot 用得更多，我们可以多次录制快照，然后比对快照，哪些操作引发了哪些类型的数据增加或减小，非常容易定位。</p></li>
</ol>

<h2 id="扩展阅读-1">扩展阅读</h2>

<ol>
<li>视频 &#8211;]<a href="https://www.youtube.com/watch?v=L3ugr9BJqIs">5</a></li>
<li>视频 &#8211; <a href="https://www.youtube.com/watch?v=x9Jlu_h_Lyw">Google I/O 2013 &#8211; A Trip Down Memory Lane with Gmail and DevTools</a></li>
</ol>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

