<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>openSUSE启动进入紧急模式 - 陈三</title>
<meta property="og:title" content="openSUSE启动进入紧急模式 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">openSUSE启动进入紧急模式</h1>

    
    <span class="article-date">May 5, 2014</span>
    

    <div class="article-content">
      <p>我的电脑通常都不关机，晚上用完后，只合上笔记本的屏幕，让它休眠。</p>

<p>但是有一阵子，openSUSE从休眠中唤醒，进入登录界面后，登录框不见了。只有一张变色龙的背景图片。</p>

<p>碰上这种情况，通常我都是长按电源键，强制关机，然后再启动。大部分时候，这方法可行。但偶尔也失效。不过因为懒得折腾，失效就多试几次，总有某次可以。</p>

<p>但昨晚升级系统到openSUSE13.2(milestone版，慎用)，用的是<code>zypper update</code>命令，总共更新2000多个软件包，重启系统后，就直接进入紧急模式：</p>

<blockquote>
<p>Welcome to emergency mode! After logging in, type &#8220;journalctl -xb&#8221; to view system logs, &#8220;systemctl reboot&#8221; to reboot, &#8220;systemctl default&#8221; to try again to boot into default mode.</p>
</blockquote>

<p>用root账户登录后，执行：</p>

<pre><code>journalctl -xb
</code></pre>

<p>屏幕打印出很长的内容。</p>

<p>用红色突出的部分，大致是写：</p>

<blockquote>
<p>timed out waiting for device &#8230;</p>

<p>Dependency failed for /home</p>
</blockquote>

<p>等等。</p>

<p>看起来情况颇为复杂。不过简单说，就是系统出问题了，需要进入紧急模式处理，等处理好了，自然能正常进入系统。</p>

<ol>
<li><p>查看fstab内容</p>

<p><code>cat /etc/fstab</code> 命令的输出如下：</p>

<pre><code>/dev/disk/by-id/ata-WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part5 swap   swap  defaults       0 0
/dev/disk/by-id/ata-WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part6 /      ext4  acl,user_xattr 1 1
/dev/disk/by-id/ata-WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part7 /home  ext4  acl,user_xattr 1 2
proc                 /proc                proc       defaults              0 0
sysfs                /sys                 sysfs      noauto                0 0
debugfs              /sys/kernel/debug    debugfs    noauto                0 0
usbfs                /proc/bus/usb        usbfs      noauto                0 0
devpts               /dev/pts             devpts     mode=0620,gid=5       0 0
</code></pre></li>

<li><p>查看/dev/disk/by-id情况</p>

<p>命令<code>ls -l /dev/disk/by-id</code>的输出如下：</p>

<pre><code>总用量 0
lrwxrwxrwx 1 root root  9 5月   8 00:06 ata-HL-DT-STDVDRAM_GT33N_M00B9DF4147 -&gt; ../../sr0
lrwxrwxrwx 1 root root  9 5月   8 00:06 ata-WDC_WD3200BEKT-0_WD-WXL1A9103779 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 ata-WDC_WD3200BEKT-0_WD-WXL1A9103779-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 ata-WDC_WD3200BEKT-0_WD-WXL1A9103779-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 ata-WDC_WD3200BEKT-0_WD-WXL1A9103779-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 ata-WDC_WD3200BEKT-0_WD-WXL1A9103779-part7 -&gt; ../../sda7
lrwxrwxrwx 1 root root  9 5月   8 00:06 scsi-0ATA_WDC_WD3200BEKT-0_WD-WXL1A9103779 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-0ATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-0ATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-0ATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-0ATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part7 -&gt; ../../sda7
lrwxrwxrwx 1 root root  9 5月   8 00:06 scsi-1ATA_WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-1ATA_WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-1ATA_WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-1ATA_WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-1ATA_WDC_WD3200BEKT-08PVMT1_WD-WXL1A9103779-part7 -&gt; ../../sda7
lrwxrwxrwx 1 root root  9 5月   8 00:06 scsi-350014ee601c73034 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-350014ee601c73034-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-350014ee601c73034-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-350014ee601c73034-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-350014ee601c73034-part7 -&gt; ../../sda7
lrwxrwxrwx 1 root root  9 5月   8 00:06 scsi-SATA_WDC_WD3200BEKT-0_WD-WXL1A9103779 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-SATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-SATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-SATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 scsi-SATA_WDC_WD3200BEKT-0_WD-WXL1A9103779-part7 -&gt; ../../sda7
lrwxrwxrwx 1 root root  9 5月   8 00:06 wwn-0x50014ee601c73034 -&gt; ../../sda
lrwxrwxrwx 1 root root 10 5月   8 00:06 wwn-0x50014ee601c73034-part2 -&gt; ../../sda2
lrwxrwxrwx 1 root root 10 5月   8 00:06 wwn-0x50014ee601c73034-part5 -&gt; ../../sda5
lrwxrwxrwx 1 root root 10 5月   8 00:06 wwn-0x50014ee601c73034-part6 -&gt; ../../sda6
lrwxrwxrwx 1 root root 10 5月   8 00:06 wwn-0x50014ee601c73034-part7 -&gt; ../../sda7
</code></pre></li>
</ol>

<p>对比之下，可以看到fstab里by-id字符串的值与/dev/disk/by-id输出的并不一样。</p>

<p>刚开始我并不敢确认，是否应该将fstab里的by-id统一为/dev/disk/by-id里对应的值，所以采用的是UUID。</p>

<p>执行命令<code>blkid</code>的查看UUID值如下：</p>

<pre><code>/dev/sda5: UUID=&quot;748d099e-2e51-4886-8f29-d3d39739d7d9&quot; TYPE=&quot;swap&quot; PARTUUID=&quot;000b4909-05&quot; 
/dev/sda6: UUID=&quot;234f7253-edbc-440b-aee6-a621641b1a9d&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;000b4909-06&quot; 
/dev/sda7: UUID=&quot;6bf3c07e-f883-427c-aba2-82a4b445c2e6&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;000b4909-07&quot; 
</code></pre>

<p>然后修改fstab：</p>

<pre><code>UUID=748d099e-2e51-4886-8f29-d3d39739d7d9 swap      swap       defaults              0 0
UUID=234f7253-edbc-440b-aee6-a621641b1a9d /         ext4       acl,user_xattr        1 1
UUID=6bf3c07e-f883-427c-aba2-82a4b445c2e6 /home                ext4       acl,user_xattr        1 2
proc                 /proc                proc       defaults              0 0
sysfs                /sys                 sysfs      noauto                0 0
debugfs              /sys/kernel/debug    debugfs    noauto                0 0
usbfs                /proc/bus/usb        usbfs      noauto                0 0
devpts               /dev/pts             devpts     mode=0620,gid=5       0 0
</code></pre>

<p>重启系统：</p>

<pre><code>shutdown -r now
</code></pre>

<p>很幸运地开启登录窗口。</p>

<p>后来证明，把fstab里by-id字符串统一为/dev/disk/by-id里对应的值也是可行的。</p>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

