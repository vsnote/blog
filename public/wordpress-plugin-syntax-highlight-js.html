<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>WordPress 代码高亮插件 Highlight.js - 陈三</title>
<meta property="og:title" content="WordPress 代码高亮插件 Highlight.js - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">1 min read</span>
    

    <h1 class="article-title">WordPress 代码高亮插件 Highlight.js</h1>

    
    <span class="article-date">April 4, 2013</span>
    

    <div class="article-content">
      

<p><a href="http://highlightjs.org/">Highlight.js</a> 支持71种程序代码的语法高亮，提供<a href="http://highlightjs.org/static/test.html">44种样式</a>及各种<a href="http://softwaremaniacs.org/soft/highlight/en/addons/">扩展插件</a>，其中包括 <a href="http://wordpress.org/extend/plugins/wp-highlightjs/">WordPress 插件</a>。</p>

<p>但用 WordPress 插件做<strong>代码高亮</strong>时，<a href="https://developers.google.com/speed/pagespeed/insights">Google PageSpeed 测试中</a>，会出现如下建议：</p>

<blockquote>
<p>The following external CSS files were included after an external JavaScript file in <a href="http://www.zfanw.com/blog/wordpress-add-jquery.html">http://www.zfanw.com/blog/wordpress-add-jquery.html</a>. To ensure CSS files are downloaded in parallel, always include external CSS before external JavaScript.</p>

<p><a href="http://www.zfanw.com/blog/wp-content/plugins/wp-highlightjs/styles/default.css">http://www.zfanw.com/blog/wp-content/plugins/wp-highlightjs/styles/default.css</a></p>
</blockquote>

<p>Highlight.js 插件将 CSS 文件附加到 JS 文件后，并且插件设置中没有提供任何调整顺序的选项。这会导致 CSS 文件不能并行请求。</p>

<hr />

<p>类似于 Google 提供的第三方库 CDN 服务，Yandex(俄罗斯的搜索引擎) 也有提供<a href="http://api.yandex.ru/jslibs/libs.xml">类似的公共服务</a>，并且有 highlight.js，我可以在 WordPress 里直接引用 highlight 的 js 与 css 文件，文件出现的顺序就变得可控。</p>

<p>打开 WordPress 的 functions.php 文件，加入如下代码：</p>

<pre><code>&lt;?php
    function zfanw_add_highlight_js(){
        wp_enqueue_style('highlightcss','http://yandex.st/highlightjs/8.0/styles/default.min.css');
        wp_enqueue_script('highlightjs','http://yandex.st/highlightjs/8.0/highlight.min.js',array(),null,true);
    }
    add_action('wp_enqueue_scripts', 'zfanw_add_highlight_js');
?&gt;
</code></pre>

<p>最后在 Footer.php 或 Header.php 文件中触发：</p>

<pre><code>&lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
</code></pre>

<p>保存后，highlight.js 会查找页面内的代码片段，自动判断语言类型，并根据 CSS 样式主题高亮显示不同语法。如本页面所示的代码样式。</p>

<p>如果要换掉代码高亮的样式主题，则只要将调用的 CSS 路径替换掉即可，比如，要从默认主题换成 Zenburn 主题：</p>

<pre><code> wp_enqueue_style('highlightcss','http://yandex.st/highlightjs/8.0/styles/zenburn.min.css');
</code></pre>

<h2 id="参考">参考</h2>

<ol>
<li><a href="https://github.com/isagalaev/highlight.js">highlight.js 说明</a></li>
<li><a href="https://codex.wordpress.org/Function_Reference/wp_enqueue_script">wp_enqueue_script</a></li>
</ol>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

