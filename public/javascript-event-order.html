<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>JavaScript 事件发生顺序 - 陈三</title>
<meta property="og:title" content="JavaScript 事件发生顺序 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">1 min read</span>
    

    <h1 class="article-title">JavaScript 事件发生顺序</h1>

    
    <span class="article-date">January 1, 2013</span>
    

    <div class="article-content">
      

<p>如下一段 HTML 代码：</p>

<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.zfanw.com/blog/&quot;&gt;陈三&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>如果点击链接，click 事件不仅仅发生在 a 元素上，p 元素也有，document 这个根元素也有，如果给它们都绑定了 click 事件处理函数，谁会先发生？</p>

<p>给它们分别绑定事件处理函数，如下：</p>

<pre><code>&lt;!DOCTYPE HTML&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body onclick=&quot;alert('hey you just click a body element')&quot;&gt;
    &lt;p onclick=&quot;alert('hey you just click a p element')&quot;&gt;&lt;a href=&quot;http://www.zfanw.com/blog/&quot; onclick=&quot;alert('hey you just click on a element');return false&quot;&gt;陈三&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>见 <a href="http://jsfiddle.net/chenxsan/R4cyq/">jsfiddle</a>：</p>

<p>在 firefox 17 下，点击链接的话，a 的事件最早触发，然后是 p，然后是 body。</p>

<p>在 IE6 下，点击的情况也是一样。</p>

<p>即它们都采取了冒泡(bubble)方式。Netscape 中采取的是捕获(capture)方式，不过 Netscape 浏览器已经死了，所以可以认为，<strong>目前的浏览器默认都采用冒泡方式</strong>。</p>

<p>但 W3C 定义的事件注册方法 addEventListener 允许通过一个布尔参数来修改：</p>

<pre><code>target.addEventListener(type, listener[, useCapture]);
</code></pre>

<p>如果 useCapture 默认为 true，则采用捕获方式。</p>

<p>来看一个<a href="http://jsfiddle.net/chenxsan/TX8CW/">例子</a>，在支持 W3C 事件注册方法的浏览器下，点击链接会先显示 p 元素被点击，然后是 a，然后是 body。</p>

<p>这是因为 W3C 事件注册方法同时支持事件处理的捕获与冒泡阶段。而通过 <code>useCapture</code> 值设置为真将 p 元素的单击事件捆绑到捕获阶段，在 W3C DOM 事件规定中，捕获阶段先于冒泡发生，即 body -&gt; p -&gt; a -&gt; p -&gt; body 这样的顺序。于是 p 的单击事件最早发生，随后是 a，最后冒泡到 body。</p>

<p>当然，冒泡也是可以取消的。方法仍有两种，一是 IE，一是 W3C:</p>

<ol>
<li>W3C &#8211; event.stopPropagation();</li>
<li>IE &#8211; window.event.cancelBubble = true;</li>
</ol>

<h2 id="参考">参考</h2>

<ol>
<li><a href="http://www.quirksmode.org/js/events_order.html">Events order</a></li>
</ol>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

