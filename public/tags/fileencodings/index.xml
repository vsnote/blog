<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Fileencodings on 陈三</title>
    <link>https://www.zfanw.com/blog/tags/fileencodings/</link>
    <description>Recent content in Fileencodings on 陈三</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Sat, 10 Mar 2012 23:59:16 +0000</lastBuildDate>
    <atom:link href="https://www.zfanw.com/blog/tags/fileencodings/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>VIM 编码</title>
      <link>https://www.zfanw.com/blog/vim-encoding-fileencoding-fileencodings.html</link>
      <pubDate>Sat, 10 Mar 2012 23:59:16 +0000</pubDate>
      
      <guid>https://www.zfanw.com/blog/vim-encoding-fileencoding-fileencodings.html</guid>
      <description>&lt;div id=&#34;toc_container&#34; class=&#34;ml-l u-floatRight pure-u-1-1 pure-u-sm-2-5 toc_white no_bullets&#34;&gt;
  &lt;nav id=&#34;myaffix&#34;&gt;
  
  &lt;p class=&#34;toc-title&#34;&gt;
    目录
  &lt;/p&gt;
  
  &lt;ul class=&#34;toc-list nav&#34; role=&#34;menu&#34;&gt;
    &lt;li class=&#34;toc-list__item&#34; role=&#34;menuitem&#34;&gt;
      &lt;a href=&#34;#i&#34;&gt;&lt;span class=&#34;toc_number toc_depth_1&#34;&gt;1&lt;/span&gt; 乱码&lt;/a&gt;
    &lt;/li&gt;
    &lt;li class=&#34;toc-list__item&#34; role=&#34;menuitem&#34;&gt;
      &lt;a href=&#34;#i-2&#34;&gt;&lt;span class=&#34;toc_number toc_depth_1&#34;&gt;2&lt;/span&gt; 测试&lt;/a&gt;
    &lt;/li&gt;
    &lt;li class=&#34;toc-list__item&#34; role=&#34;menuitem&#34;&gt;
      &lt;a href=&#34;#i-3&#34;&gt;&lt;span class=&#34;toc_number toc_depth_1&#34;&gt;3&lt;/span&gt; 总结&lt;/a&gt;
    &lt;/li&gt;
    &lt;li class=&#34;toc-list__item&#34; role=&#34;menuitem&#34;&gt;
      &lt;a href=&#34;#Ubuntu_Gvim_option&#34;&gt;&lt;span class=&#34;toc_number toc_depth_1&#34;&gt;4&lt;/span&gt; Ubuntu 下 Gvim 的 option&lt;/a&gt;
    &lt;/li&gt;
  &lt;/ul&gt;&lt;/nav&gt;
&lt;/div&gt;

&lt;div class=&#34;&#34;&gt;
  &lt;h2 class=&#34;storycontent-h2&#34;&gt;
    &lt;span id=&#34;i&#34;&gt;乱码&lt;/span&gt;&lt;a title=&#34;标题链接地址&#34; class=&#34;u-floatRight hidden&#34; id=&#34;heyi&#34; href=&#34;#i&#34;&gt;&lt;span class=&#34;&#34; aria-hidden=&#34;true&#34;&gt;#&lt;/span&gt;&lt;/a&gt;
  &lt;/h2&gt;
  
  &lt;p&gt;
    Vim 里关于编码有多个 option，比如 encoding、fileencoding、fileencodings、termencoding。用 &lt;kbd&gt;:help xxx&lt;/kbd&gt; 分别查看，就会有一个疑问：为什么会有这么多 option 存在？然后你可以自言自语地总结：存在总是有其历史的不正确的原因或者非历史的正确原因。
  &lt;/p&gt;
  
  &lt;p&gt;
    但对于普通用户来说，其实无谓多少 option 存在，只要能不乱码，又或者乱了知道怎么处理就够了。
  &lt;/p&gt;
  
  &lt;h2 class=&#34;storycontent-h2&#34;&gt;
    &lt;span id=&#34;i-2&#34;&gt;测试&lt;/span&gt;&lt;a title=&#34;标题链接地址&#34; class=&#34;u-floatRight hidden&#34; id=&#34;heyi-2&#34; href=&#34;#i-2&#34;&gt;&lt;span class=&#34;&#34; aria-hidden=&#34;true&#34;&gt;#&lt;/span&gt;&lt;/a&gt;
  &lt;/h2&gt;
  
  &lt;p&gt;
    Windows 7 下 Gvim 7.3.46 版本，界面为中文，环境变量 $LANG 值为 zh-CN，上面几个 option 的默认值分别为：
  &lt;/p&gt;
  
  &lt;ul&gt;
    &lt;li&gt;
      termencoding=
    &lt;/li&gt;
    &lt;li&gt;
      encoding=cp936
    &lt;/li&gt;
    &lt;li&gt;
      fileencoding=
    &lt;/li&gt;
    &lt;li&gt;
      fileencodings=ucs-bom
    &lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;p&gt;
    按帮助内容说，当 termencoding 值为空时，取值与 encoding 一样，即也为 &lt;a href=&#34;http://en.wikipedia.org/wiki/Code_page_936&#34;&gt;cp936&lt;/a&gt;，cp936 是微软的简体中文字符编码集。
  &lt;/p&gt;
  
  &lt;p&gt;
    fileencoding 为空其取值也是与 encoding 一样，也是 cp936。
  &lt;/p&gt;
  
  &lt;p&gt;
    针对文件我们可以有两种常见行为，一是创建，一是读取，创建时用一种编码集，读取时又用一种编码集，如果读取时所用的编码集与创建时所用不同，就可能出现乱码。
  &lt;/p&gt;
  
  &lt;h3&gt;
    记事本下的不同编码
  &lt;/h3&gt;
  
  &lt;p&gt;
    我的测试是打开记事本，并分别另存两个 txt 文件，一个编码为 ANSI ，一个编码为 UTF-8，然后用 Gvim 打开并查看上述各 option 的取值变化。
  &lt;/p&gt;
  
  &lt;ul&gt;
    &lt;li&gt;
      ANSI &lt;ul&gt;
        &lt;li&gt;
          termencoding=
        &lt;/li&gt;
        &lt;li&gt;
          encoding=cp936
        &lt;/li&gt;
        &lt;li&gt;
          fileencoding=
        &lt;/li&gt;
        &lt;li&gt;
          fileencodings=ucs-bom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    
    &lt;li&gt;
      UTF-8 &lt;ul&gt;
        &lt;li&gt;
          termencoding=
        &lt;/li&gt;
        &lt;li&gt;
          encoding=cp936
        &lt;/li&gt;
        &lt;li&gt;
          fileencoding=utf-8
        &lt;/li&gt;
        &lt;li&gt;
          fileencodings=ucs-bom
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;p&gt;
    从结果可以看到，记事本保存的两个不同编码文件在 Vim 中打开并未出现乱码的情况。
  &lt;/p&gt;
  
  &lt;h3&gt;
    乱码来了
  &lt;/h3&gt;
  
  &lt;p&gt;
    那么来见一下乱码的情形。
  &lt;/p&gt;
  
  &lt;p&gt;
    在 Vim 的配置文件 _vimrc 里加上一句 &lt;code&gt;set fileencoding=utf-8&lt;/code&gt;，然后从 Vim 中新建一个 vim-utf-8.txt 文件，保存后重新用 Vim 打开，接着乱码就出现了。查看各个 option 值，唯 fileencoding 值与新建时不一样，变成 cp936。
  &lt;/p&gt;
  
  &lt;p&gt;
    也就是说，在新建这个文件时所用的编码是 utf-8，到打开时使用的却是 cp936，因为 utf-8 的字符集要大于 cp936，于是就出现乱码。
  &lt;/p&gt;
  
  &lt;p&gt;
    所以我们需要 Vim 在读取文件时认得其所用编码，又或者读取所用的字符集包含了创建所用的字符集。
  &lt;/p&gt;
  
  &lt;h3&gt;
    解决乱码
  &lt;/h3&gt;
  
  &lt;p&gt;
    在 _vimrc 文件中增加一行 &lt;code&gt;set fileencodings=utf-8,&amp;lt;a href=&#34;https://zh.wikipedia.org/wiki/位元組順序記號&#34;&gt;ucs-bom&amp;lt;/a&gt;&lt;/code&gt;，这样 Vim 在读取时给要打开的文件应用的编码就按 fileencodings 从从左住右应用第一个找到的可用编码，类似于 CSS 下的 font-family 用法。
  &lt;/p&gt;
  
  &lt;p&gt;
    重新打开 vim-utf-8.txt 文件，这时乱码已经消失，查看 fileencoding 值，已经是 utf-8 了。
  &lt;/p&gt;
  
  &lt;p&gt;
    另外，上述乱码情况在不更改 fileencodings 的情况下可以使用在 Vim 命令行模式下调用 &lt;kbd&gt;:e ++enc=utf-8&lt;/kbd&gt; 强制更改，一如 &lt;a href=&#34;http://www.zfanw.com/blog/vim-file-format-problem.html&#34;&gt;Vim 文件格式&lt;/a&gt; 一篇提到的办法。
  &lt;/p&gt;
  
  &lt;h2 class=&#34;storycontent-h2&#34;&gt;
    &lt;span id=&#34;i-3&#34;&gt;总结&lt;/span&gt;&lt;a title=&#34;标题链接地址&#34; class=&#34;u-floatRight hidden&#34; id=&#34;heyi-3&#34; href=&#34;#i-3&#34;&gt;&lt;span class=&#34;&#34; aria-hidden=&#34;true&#34;&gt;#&lt;/span&gt;&lt;/a&gt;
  &lt;/h2&gt;
  
  &lt;ul&gt;
    &lt;li&gt;
      创建文件时所用编码据 fileencoding 值
    &lt;/li&gt;
    &lt;li&gt;
      读取文件时所应用编码据 fileencodings 值
    &lt;/li&gt;
    &lt;li&gt;
      termencoding 与 encoding 值平常用户一般不用管
    &lt;/li&gt;
  &lt;/ul&gt;
  
  &lt;h2 class=&#34;storycontent-h2&#34;&gt;
    &lt;span id=&#34;Ubuntu_Gvim_option&#34;&gt;Ubuntu 下 Gvim 的 option&lt;/span&gt;&lt;a title=&#34;标题链接地址&#34; class=&#34;u-floatRight hidden&#34; id=&#34;heyUbuntu_Gvim_option&#34; href=&#34;#Ubuntu_Gvim_option&#34;&gt;&lt;span class=&#34;&#34; aria-hidden=&#34;true&#34;&gt;#&lt;/span&gt;&lt;/a&gt;
  &lt;/h2&gt;
  
  &lt;ul&gt;
    &lt;li&gt;
      $LANG=en.US_UTF-8
    &lt;/li&gt;
    &lt;li&gt;
      termencoding=utf-8
    &lt;/li&gt;
    &lt;li&gt;
      encoding=utf-8
    &lt;/li&gt;
    &lt;li&gt;
      fileencoding=
    &lt;/li&gt;
    &lt;li&gt;
      fileencodings=ucs-bom,utf-8,default,latin1
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>