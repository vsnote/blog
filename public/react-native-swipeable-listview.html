<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.16" />


<title>react-native 滑动删除 - 陈三</title>
<meta property="og:title" content="react-native 滑动删除 - 陈三">



  






<link rel="stylesheet" href="https://www.zfanw.com/blog/css/main.css" media="all">

  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="https://www.zfanw.com/blog/" class="nav-logo">陈三</a>

  <ul class="nav-links">
    
    <li><a href="/blog/">Home</a></li>
    
    <li><a href="/blog/about/">关于</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">react-native 滑动删除</h1>

    
    <span class="article-date">June 6, 2016</span>
    

    <div class="article-content">
      <p><strong>说明</strong>：本文基于 react-native 0.29.0-rc.0，仅针对 iOS 平台。</p>

<p>iOS 下的列表，通常都可以往左滑动，显示快捷菜单 &#8211; 比如删除。</p>

<p>只是 react-native 下的 ListView 不具备这种功能。</p>

<p>但实际上，react-native 官方库里，就有一个 <a href="https://github.com/facebook/react-native/tree/master/Libraries/Experimental/SwipeableRow">SwipeableListView</a>，只不过是放在 <code>Experimental</code> 目录下，表示还不成熟 &#8211; 目前也是没有文档的，只能自己阅读源代码。</p>

<p>其实用法非常简单，大部分跟 ListView 是一致的，只是多了些 prop。</p>

<p>来看一个示例：</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span><span style="color: #A90D91">import</span> <span style="color: #000000">React</span> <span style="color: #000000">from</span> <span style="color: #C41A16">&#39;react&#39;</span>
<span style="color: #A90D91">import</span> { <span style="color: #000000">ScrollView</span>, <span style="color: #000000">View</span>, <span style="color: #000000">TouchableHighlight</span>, <span style="color: #000000">Text</span>, <span style="color: #000000">SwipeableListView</span> } <span style="color: #000000">from</span> <span style="color: #C41A16">&#39;react-native&#39;</span>
<span style="color: #A90D91">import</span> { <span style="color: #000000">connect</span> } <span style="color: #000000">from</span> <span style="color: #C41A16">&#39;react-redux&#39;</span>
<span style="color: #A90D91">import</span> <span style="color: #000000">styles</span> <span style="color: #000000">from</span> <span style="color: #C41A16">&#39;./styles&#39;</span>
<span style="color: #A90D91">import</span> <span style="color: #000000">formatListViewDataSource</span> <span style="color: #000000">from</span> <span style="color: #C41A16">&#39;../../utils/formatListViewDataSource&#39;</span>
<span style="color: #A90D91">class</span> <span style="color: #000000">WantHome</span> <span style="color: #A90D91">extends</span> <span style="color: #000000">React</span>.<span style="color: #000000">Component</span> {
  <span style="color: #000000">componentDidMount</span> () {
    <span style="color: #A90D91">this</span>.<span style="color: #000000">props</span>.<span style="color: #000000">dispatch</span>({
      <span style="color: #000000">type:</span> <span style="color: #C41A16">&#39;USER_ENTERED_WANT_HOME&#39;</span>
    })
  }
  <span style="color: #000000">render</span> () {
    <span style="color: #A90D91">let</span> <span style="color: #000000">ds</span> <span style="color: #000000">=</span> <span style="color: #000000">SwipeableListView</span>.<span style="color: #000000">getNewDataSource</span>()
    <span style="color: #A90D91">let</span> <span style="color: #000000">obj</span> <span style="color: #000000">=</span> <span style="color: #000000">formatListViewDataSource</span>(<span style="color: #A90D91">this</span>.<span style="color: #000000">props</span>.<span style="color: #000000">want</span>)
    <span style="color: #000000">ds</span> <span style="color: #000000">=</span> <span style="color: #000000">ds</span>.<span style="color: #000000">cloneWithRowsAndSections</span>(...<span style="color: #000000">obj</span>)
    <span style="color: #A90D91">if</span> (<span style="color: #000000">!</span><span style="color: #A90D91">this</span>.<span style="color: #000000">props</span>.<span style="color: #000000">want</span>.<span style="color: #000000">length</span>) {
      <span style="color: #A90D91">return</span> (
        <span style="color: #000000">&lt;View</span> <span style="color: #000000">style=</span>{[<span style="color: #000000">styles</span>.<span style="color: #000000">container</span>, <span style="color: #000000">styles</span>.<span style="color: #000000">center</span>]}<span style="color: #000000">&gt;</span>
          <span style="color: #000000">&lt;Text&gt;暂无内容，请点击右上角按钮添加&lt;/Text&gt;</span>
        <span style="color: #000000">&lt;/View&gt;</span>
      )
    } <span style="color: #A90D91">else</span> {
      <span style="color: #A90D91">return</span> (
        <span style="color: #000000">&lt;ScrollView</span> <span style="color: #000000">style=</span>{[<span style="color: #000000">styles</span>.<span style="color: #000000">body</span>]}<span style="color: #000000">&gt;</span>
          <span style="color: #000000">&lt;SwipeableListView</span>
            <span style="color: #000000">bounceFirstRowOnMount</span>
            <span style="color: #000000">maxSwipeDistance=</span>{<span style="color: #1C01CE">100</span>}
            <span style="color: #000000">dataSource=</span>{<span style="color: #000000">ds</span>}
            <span style="color: #000000">renderQuickActions=</span>{(<span style="color: #000000">rowData</span>, <span style="color: #000000">sectionID</span>, <span style="color: #000000">rowID</span>) <span style="color: #000000">=&gt;</span> {
              <span style="color: #A90D91">return</span> (
                <span style="color: #000000">&lt;View</span> <span style="color: #000000">style=</span>{{
                  <span style="color: #000000">flex:</span> <span style="color: #1C01CE">1</span>,
                  <span style="color: #000000">flexDirection:</span> <span style="color: #C41A16">&#39;row&#39;</span>,
                  <span style="color: #000000">justifyContent:</span> <span style="color: #C41A16">&#39;flex-end&#39;</span>,
                  <span style="color: #000000">alignItems:</span> <span style="color: #C41A16">&#39;center&#39;</span>
                }}<span style="color: #000000">&gt;</span>
                  <span style="color: #000000">&lt;TouchableHighlight</span>
                    <span style="color: #000000">onPress=</span>{() <span style="color: #000000">=&gt;</span> {
                      <span style="color: #000000">alert</span>(<span style="color: #1C01CE">1</span>)
                    }}<span style="color: #000000">&gt;</span>
                    <span style="color: #000000">&lt;View</span> <span style="color: #000000">style=</span>{{
                      <span style="color: #000000">backgroundColor:</span> <span style="color: #C41A16">&#39;red&#39;</span>,
                      <span style="color: #000000">flex:</span> <span style="color: #1C01CE">1</span>,
                      <span style="color: #000000">alignItems:</span> <span style="color: #C41A16">&#39;center&#39;</span>,
                      <span style="color: #000000">flexDirection:</span> <span style="color: #C41A16">&#39;row&#39;</span>,
                      <span style="color: #000000">paddingHorizontal:</span> <span style="color: #1C01CE">10</span>
                    }}<span style="color: #000000">&gt;</span>
                      <span style="color: #000000">&lt;Text</span> <span style="color: #000000">style=</span>{{
                        <span style="color: #000000">color:</span> <span style="color: #C41A16">&#39;white&#39;</span>,
                        <span style="color: #000000">fontSize:</span> <span style="color: #1C01CE">16</span>
                      }}<span style="color: #000000">&gt;删除&lt;/Text&gt;</span>
                    <span style="color: #000000">&lt;/View&gt;</span>
                  <span style="color: #000000">&lt;/TouchableHighlight&gt;</span>
                <span style="color: #000000">&lt;/View&gt;</span>
              )
            }}
            <span style="color: #000000">renderRow=</span>{(<span style="color: #000000">rowData</span>) <span style="color: #000000">=&gt;</span> {
              <span style="color: #A90D91">return</span> (
                <span style="color: #000000">&lt;View</span> <span style="color: #000000">style=</span>{{
                  <span style="color: #000000">paddingVertical:</span> <span style="color: #1C01CE">10</span>,
                  <span style="color: #000000">backgroundColor:</span> <span style="color: #C41A16">&#39;#fff&#39;</span>
                }}<span style="color: #000000">&gt;</span>
                  <span style="color: #000000">&lt;Text</span> <span style="color: #000000">style=</span>{{
                    <span style="color: #000000">fontSize:</span> <span style="color: #1C01CE">16</span>
                  }}<span style="color: #000000">&gt;</span>
                    {<span style="color: #000000">rowData</span>.<span style="color: #000000">text</span>}
                  <span style="color: #000000">&lt;/Text&gt;</span>
                <span style="color: #000000">&lt;/View&gt;</span>
              )
            }}
          <span style="color: #000000">/&gt;</span>
        <span style="color: #000000">&lt;/ScrollView&gt;</span>
      )
    }
  }
}
<span style="color: #A90D91">const</span> <span style="color: #000000">mapStateToProps</span> <span style="color: #000000">=</span> (<span style="color: #000000">state</span>) <span style="color: #000000">=&gt;</span> ({
  <span style="color: #000000">want:</span> <span style="color: #000000">state</span>.<span style="color: #000000">want</span>
})
<span style="color: #A90D91">export</span> <span style="color: #A90D91">default</span> <span style="color: #000000">connect</span>(<span style="color: #000000">mapStateToProps</span>)(<span style="color: #000000">WantHome</span>)
</pre></div>

<p>这里有几个需要注意的属性值：</p>

<ol>
<li><p><code>dataSource</code> &#8211; 我们要渲染的数据列表。</p>

<p>通常我们会有一个数组，比如 <code>['咸饭', '粥']</code>，数据需要处理成 <code>SwipeableListView</code> 需要的格式，比如：</p>

<pre><code>{
's1': '标题',
'r1': '咸饭',
'r2': '粥'
}
</code></pre>

<p>这也是上面代码中 <code>formatListViewDataSource</code> 函数起到的作用：</p>

<pre><code>/**
* @function formatListViewDataSource format data for ListView of react-native
* @param {Array} data - data to be formatted
* @return {Array}
* @example
*   let ds = formatListViewDataSource([1, 2, 3])
*   xxx.cloneWithRowsAndSections(...ds)
*/
export default function formatListViewDataSource (data) {
if (!Array.isArray(data)) {
throw new Error('function only accept Array')
}
var dataBlob = {}
var sectionIDs = ['s1']
var rowIDs = [[]]
data.forEach(function (element, index) {
dataBlob['r' + index] = {id: 'r' + index, text: element}
rowIDs[0].push('r' + index)
})
dataBlob['s1'] = ''
return [
dataBlob,
sectionIDs,
rowIDs
]
}
</code></pre></li>

<li><p><code>maxSwipeDistance</code> &#8211; 表示滑动的最大距离，必须设置，否则默认为 0</p></li>

<li><p><code>renderQuickActions</code> &#8211; 这就是我们滑动后显示的快捷动作了</p></li>
</ol>

<p>效果如下图：</p>

<p><a href="https://www.zfanw.com/blog/wp-content/uploads/2016/06/react-native-swipeablelist.gif"><img src="https://www.zfanw.com/blog/wp-content/uploads/2016/06/react-native-swipeablelist.gif" alt="react native swipeableListView" width="372" class="alignnone size-full wp-image-18623" /></a></p>

    </div>
  </article>

  

</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="https://www.zfanw.com/blog/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with Hugo</a>
          </li>
        </ul>
      </footer>

    </div>

    
  </body>
</html>

